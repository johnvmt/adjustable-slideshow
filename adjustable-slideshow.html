<template is="adjustable-slideshow">
	<style>
		:host {
			display: block;
			height: 100%;
			width: 100%;
		}

		::slotted(.adjustable-slideshow-hidden) {
			display: none;
		}

	</style>
	<!--<link rel="stylesheet" type="text/css" href="bower_components/animate.css/animate.min.css">-->

	<div id="container" style="width: 100%; height: 100%; background-color: #333333; overflow: hidden">
		<div id="content" style="width: 100%; height: 100%; z-index: 0; position: absolute; top: 0; left: 0;">
			<slot></slot>
		</div>
	</div>
</template>

<script>
	(function() {
		let componentDoc =  (document._currentScript || document.currentScript).ownerDocument;
		let componentDir = componentDoc.baseURI.substring(0, componentDoc.baseURI.lastIndexOf('/'));
		let componentFile = componentDoc.baseURI.substring(componentDoc.baseURI.lastIndexOf('/') + 1);
		let componentName = componentFile.substring(0, componentFile.lastIndexOf('.'));
		class AdjustableSlideshow extends HTMLElement {
			constructor() {
				super();

				this.selected = "0";

				let thisElem = this;

				// Gets content from <template>
				let shadow = this.attachShadow({mode: 'open'});
				let template = componentDoc.querySelector('template[is=adjustable-slideshow]').content;
				shadow.appendChild(document.importNode(template, true));

				this.elements = {
					container: shadow.querySelector('slot')
				};

				this.elements.container.addEventListener('slotchange', function() {
					thisElem.makeTop(thisElem.getAttribute('selected'));
				});

				this.childFilter = function (node) {
					return ['#text', 'DOM-REPEAT'].indexOf(node.nodeName) < 0; // Exclude whitespace at beginning and end
				}
			}

			get selected() {
				return this.getAttribute('selected') || '0';
			}

			set selected(val) {
				return this.setAttribute('selected', val);
			}

			static get observedAttributes() {
				return ['selected'];
			}

			makeTop(slideIndex, mirrorTag) {
				let thisElem = this;
				let elements = thisElem.slotElements();
				let hiddenClass = 'adjustable-slideshow-hidden';

				if(typeof slideIndex != 'number') {
					try {
						slideIndex = Number(slideIndex);
					}
					catch(error) {
						slideIndex = 0;
					}
				}

				let ctr = 0;
				elements.forEach(function(element) {
					if(ctr == slideIndex) {
						if(thisElem.hasClass(element, hiddenClass)) {
							thisElem.removeClass(element, hiddenClass);
							thisElem.setAttribute('selected', String(slideIndex));
							thisElem.emitMirror(mirrorTag, 'makeTop', [slideIndex]);
						}
					}
					else
						thisElem.addClass(element, 'adjustable-slideshow-hidden');

					ctr++;
				});
			};

			slotElements(slot) {
				if(typeof slot == 'undefined')
					slot = this.elements.container;

				let elements = slot.assignedNodes().filter(function(element) {
					return ['#text', 'DOM-REPEAT'].indexOf(element.nodeName) < 0; // Exclude whitespace at beginning and end
				});

				if(elements.length == 1 && elements[0].nodeName == 'SLOT')
					return this.slotElements(elements[0]);
				else
					return elements;
			}

			emitMirror(mirrorTag, functionName, functionArgs) {
				if(!Array.isArray(functionArgs))
					functionArgs = [];

				let emitMirrorDetail = {function: functionName, arguments: functionArgs};
				if(typeof mirrorTag != 'undefined')
					emitMirrorDetail.tag = mirrorTag;

				let mirrorEvent = new CustomEvent('mirror', {detail: emitMirrorDetail});
				this.dispatchEvent(mirrorEvent);

			};

			attributeChangedCallback(attribute, oldVal, newVal) {
				if(attribute == 'selected' && oldVal != newVal)
					this.makeTop(newVal);
			};

			hasClass(el, className) {
				if(el.classList)
					return el.classList.contains(className);
				else
					return !!el.className.match(new RegExp('(\\s|^)' + className + '(\\s|$)'))
			}

			addClass(el, className) {
				if(el.classList)
					el.classList.add(className);
				else if(!this.hasClass(el, className)) el.className += " " + className
			}

			removeClass(el, className) {
				if(el.classList)
					el.classList.remove(className);
				else if(this.hasClass(el, className)) {
					let reg = new RegExp('(\\s|^)' + className + '(\\s|$)');
					el.className=el.className.replace(reg, ' ')
				}
			}
		}

		customElements.define('adjustable-slideshow', AdjustableSlideshow);
	})();
</script>